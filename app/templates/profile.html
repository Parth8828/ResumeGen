{% extends "base.html" %}

{% block title %}My Profile - ResumeGen{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100">My Profile</h1>
        <div class="flex gap-2">
            <button id="analyze-btn"
                class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium transition-colors shadow-lg shadow-purple-500/30 flex items-center">
                <i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Analyze & Improve
            </button>
            <button id="save-all-btn"
                class="hidden bg-primary hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                <i class="fa-solid fa-save mr-2"></i>Save All Changes
            </button>
        </div>
    </div>

    <!-- Personal Information -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Personal Information</h2>
            <button id="edit-personal-btn" class="text-primary hover:text-blue-700 font-medium">
                <i class="fa-solid fa-edit mr-1"></i>Edit
            </button>
        </div>

        <div id="personal-view" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">Full Name</label>
                <p id="view-name" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">Email</label>
                <p id="view-email" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">Phone</label>
                <p id="view-phone" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">Location</label>
                <p id="view-location" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">LinkedIn</label>
                <p id="view-linkedin" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
            <div>
                <label class="text-sm text-slate-600 dark:text-slate-400">GitHub</label>
                <p id="view-github" class="text-slate-900 dark:text-slate-100">-</p>
            </div>
        </div>

        <form id="personal-form" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Full Name</label>
                <input type="text" id="input-name"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
                <input type="email" id="input-email"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Phone</label>
                <input type="tel" id="input-phone"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Location</label>
                <input type="text" id="input-location"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">LinkedIn</label>
                <input type="url" id="input-linkedin"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">GitHub</label>
                <input type="url" id="input-github"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div class="md:col-span-2 flex gap-2 justify-end">
                <button type="button" id="cancel-personal-btn"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">
                    Save
                </button>
            </div>
        </form>
    </div>

    <!-- Professional Summary -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Professional Summary</h2>
            <button id="edit-summary-btn" class="text-primary hover:text-blue-700 font-medium">
                <i class="fa-solid fa-edit mr-1"></i>Edit
            </button>
        </div>

        <div id="summary-view">
            <p id="view-summary" class="text-slate-700 dark:text-slate-300">No summary added yet.</p>
        </div>

        <form id="summary-form" class="hidden">
            <textarea id="input-summary" rows="4"
                class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100"
                placeholder="Write a compelling professional summary..."></textarea>
            <div class="flex gap-2 justify-end mt-2">
                <button type="button" id="cancel-summary-btn"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">
                    Save
                </button>
            </div>
        </form>
    </div>

    <!-- Experience -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Experience</h2>
            <button id="add-experience-btn"
                class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                <i class="fa-solid fa-plus mr-1"></i>Add Experience
            </button>
        </div>

        <div id="experience-list" class="space-y-4">
            <!-- Experience items will be loaded here -->
        </div>
    </div>

    <!-- Education -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Education</h2>
            <button id="add-education-btn"
                class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                <i class="fa-solid fa-plus mr-1"></i>Add Education
            </button>
        </div>

        <div id="education-list" class="space-y-4">
            <!-- Education items will be loaded here -->
        </div>
    </div>

    <!-- Skills -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Skills</h2>
            <button id="add-skill-btn" class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                <i class="fa-solid fa-plus mr-1"></i>Add Skill Category
            </button>
        </div>

        <div id="skills-list" class="space-y-4">
            <!-- Skills will be loaded here -->
        </div>
    </div>

    <!-- Projects -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Projects</h2>
            <button id="add-project-btn"
                class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                <i class="fa-solid fa-plus mr-1"></i>Add Project
            </button>
        </div>

        <div id="projects-list" class="space-y-4">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <!-- Languages -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Languages</h2>
        </div>
        <div id="languages-view">
            <div id="languages-list" class="flex flex-wrap gap-2 mb-4">
                <!-- Languages will be loaded here -->
            </div>
            <div class="flex gap-2">
                <input type="text" id="language-input" placeholder="Add a language (e.g., English, Spanish)"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                <button onclick="addLanguage()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">
                    <i class="fa-solid fa-plus mr-1"></i>Add
                </button>
            </div>
        </div>
    </div>

    <!-- Hobbies -->
    <div class="glass-card p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Hobbies & Interests</h2>
        </div>
        <div id="hobbies-view">
            <div id="hobbies-list" class="flex flex-wrap gap-2 mb-4">
                <!-- Hobbies will be loaded here -->
            </div>
            <div class="flex gap-2">
                <input type="text" id="hobby-input" placeholder="Add a hobby (e.g., Photography, Hiking)"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                <button onclick="addHobby()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">
                    <i class="fa-solid fa-plus mr-1"></i>Add
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Resume History -->
<div class="glass-card p-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100">Resume History</h2>
        <div class="flex gap-2">
            <button id="filter-favorites-btn"
                class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
                <i class="fa-solid fa-star mr-1"></i>Favorites Only
            </button>
        </div>
    </div>

    <div id="resume-history-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Resume history will be loaded here -->
    </div>
</div>
</div>

<!-- Loading Indicator -->
<div id="loading" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-slate-800 p-6 rounded-lg">
        <i class="fa-solid fa-spinner fa-spin text-4xl text-primary"></i>
        <p class="mt-2 text-slate-700 dark:text-slate-300">Loading...</p>
    </div>
</div>

<!-- Experience Modal -->
<div id="experience-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-2xl mx-4 overflow-hidden">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
            <h3 id="exp-modal-title" class="text-xl font-bold text-slate-900 dark:text-slate-100">Add Experience</h3>
            <button onclick="closeModal('experience-modal')"
                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <form id="experience-form" class="p-6 space-y-4">
            <input type="hidden" id="exp-id">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Job Title</label>
                    <input type="text" id="exp-title" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Company</label>
                    <input type="text" id="exp-company" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Start Date</label>
                    <input type="text" id="exp-start" placeholder="e.g. Jan 2020" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">End Date</label>
                    <input type="text" id="exp-end" placeholder="e.g. Present" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
                <textarea id="exp-desc" rows="3"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100"></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Achievements (One per
                    line)</label>
                <textarea id="exp-achievements" rows="3"
                    placeholder="- Improved performance by 50%&#10;- Led a team of 5"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100"></textarea>
            </div>
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" onclick="closeModal('experience-modal')"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Education Modal -->
<div id="education-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-2xl mx-4 overflow-hidden">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
            <h3 id="edu-modal-title" class="text-xl font-bold text-slate-900 dark:text-slate-100">Add Education</h3>
            <button onclick="closeModal('education-modal')"
                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <form id="education-form" class="p-6 space-y-4">
            <input type="hidden" id="edu-id">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Degree</label>
                    <input type="text" id="edu-degree" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Institution</label>
                    <input type="text" id="edu-school" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Graduation
                        Date</label>
                    <input type="text" id="edu-date" placeholder="e.g. May 2020" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">GPA
                        (Optional)</label>
                    <input type="text" id="edu-gpa"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
            </div>
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" onclick="closeModal('education-modal')"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Skills Modal -->
<div id="skills-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-md mx-4 overflow-hidden">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
            <h3 id="skill-modal-title" class="text-xl font-bold text-slate-900 dark:text-slate-100">Add Skill Category
            </h3>
            <button onclick="closeModal('skills-modal')"
                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <form id="skills-form" class="p-6 space-y-4">
            <input type="hidden" id="skill-id">
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Category</label>
                <input type="text" id="skill-category" placeholder="e.g. Programming Languages" required
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Skills (Comma
                    separated)</label>
                <textarea id="skill-list-input" rows="3" placeholder="Python, JavaScript, React" required
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100"></textarea>
            </div>
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" onclick="closeModal('skills-modal')"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Projects Modal -->
<div id="projects-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-2xl mx-4 overflow-hidden">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
            <h3 id="project-modal-title" class="text-xl font-bold text-slate-900 dark:text-slate-100">Add Project</h3>
            <button onclick="closeModal('projects-modal')"
                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>
        <form id="projects-form" class="p-6 space-y-4">
            <input type="hidden" id="project-id">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Project
                        Name</label>
                    <input type="text" id="project-name" required
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Date</label>
                    <input type="text" id="project-date" placeholder="e.g. 2023"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Description</label>
                <textarea id="project-desc" rows="3"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100"></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Technologies (Comma
                    separated)</label>
                <input type="text" id="project-tech" placeholder="Python, TensorFlow, React"
                    class="w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100">
            </div>
            <div class="flex justify-end gap-2 pt-4">
                <button type="button" onclick="closeModal('projects-modal')"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Analysis Modal -->
<div id="analysis-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div
        class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-4xl mx-4 overflow-hidden h-[90vh] flex flex-col">
        <!-- Header -->
        <div
            class="p-6 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50">
            <div>
                <h3 class="text-2xl font-bold text-slate-900 dark:text-slate-100 flex items-center">
                    <i class="fa-solid fa-chart-line text-purple-500 mr-2"></i> Resume Analysis
                </h3>
                <p class="text-slate-500 dark:text-slate-400 text-sm">AI-powered insights and improvements</p>
            </div>
            <button onclick="closeModal('analysis-modal')"
                class="text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
        </div>

        <!-- Content (Scrollable) -->
        <div class="p-6 overflow-y-auto flex-1 space-y-8">

            <!-- Score Section -->
            <div class="flex flex-col items-center justify-center py-6">
                <div class="relative w-32 h-32 flex items-center justify-center">
                    <svg class="transform -rotate-90 w-32 h-32">
                        <circle cx="64" cy="64" r="60" stroke="currentColor" stroke-width="8" fill="transparent"
                            class="text-slate-200 dark:text-slate-700" />
                        <circle id="score-circle" cx="64" cy="64" r="60" stroke="currentColor" stroke-width="8"
                            fill="transparent" stroke-dasharray="377" stroke-dashoffset="377"
                            class="text-purple-600 transition-all duration-1000 ease-out" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span id="score-value" class="text-4xl font-bold text-slate-900 dark:text-slate-100">0</span>
                        <span class="text-xs text-slate-500 uppercase font-semibold">Score</span>
                    </div>
                </div>
            </div>

            <!-- Analysis Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Strengths -->
                <div
                    class="bg-green-50 dark:bg-green-900/10 p-4 rounded-xl border border-green-100 dark:border-green-900/20">
                    <h4 class="font-bold text-green-800 dark:text-green-400 mb-3 flex items-center">
                        <i class="fa-solid fa-check-circle mr-2"></i> Key Strengths
                    </h4>
                    <ul id="analysis-strengths" class="space-y-2 text-green-900 dark:text-green-300 text-sm">
                        <!-- Populated by JS -->
                    </ul>
                </div>

                <!-- Weaknesses -->
                <div class="bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/20">
                    <h4 class="font-bold text-red-800 dark:text-red-400 mb-3 flex items-center">
                        <i class="fa-solid fa-exclamation-circle mr-2"></i> Areas for Improvement
                    </h4>
                    <ul id="analysis-weaknesses" class="space-y-2 text-red-900 dark:text-red-300 text-sm">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>

            <!-- Suggestions -->
            <div class="bg-blue-50 dark:bg-blue-900/10 p-5 rounded-xl border border-blue-100 dark:border-blue-900/20">
                <h4 class="font-bold text-blue-800 dark:text-blue-400 mb-3 flex items-center">
                    <i class="fa-solid fa-lightbulb mr-2"></i> AI Suggestions
                </h4>
                <ul id="analysis-suggestions"
                    class="space-y-2 text-blue-900 dark:text-blue-300 text-sm list-disc list-inside">
                    <!-- Populated by JS -->
                </ul>
            </div>

            <!-- Enhanced Preview Alert -->
            <div
                class="bg-purple-50 dark:bg-purple-900/10 p-4 rounded-xl border border-purple-100 dark:border-purple-900/20 flex items-start gap-3">
                <i class="fa-solid fa-wand-magic-sparkles text-purple-600 mt-1"></i>
                <div>
                    <h4 class="font-bold text-purple-900 dark:text-purple-300">AI Enhancement Ready</h4>
                    <p class="text-sm text-purple-800 dark:text-purple-400 mt-1">
                        The AI has generated a polished version of your resume with professional summary, stronger
                        action verbs, and corrected grammar.
                        Click "Apply Enhancements" to update your profile instantly.
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer Actions -->
        <div
            class="p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-end gap-3">
            <button onclick="closeModal('analysis-modal')"
                class="px-5 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 font-medium">
                Close
            </button>
            <button id="apply-enhancements-btn"
                class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 font-medium shadow-lg shadow-purple-500/30 flex items-center">
                <i class="fa-solid fa-check mr-2"></i> Apply Enhancements
            </button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-modal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl w-full max-w-sm mx-4 overflow-hidden">
        <div class="p-6 text-center">
            <div
                class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fa-solid fa-trash text-red-600 dark:text-red-400 text-xl"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100 mb-2">Delete Item?</h3>
            <p class="text-slate-600 dark:text-slate-400 mb-6">Are you sure you want to delete this? This action cannot
                be undone.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeModal('delete-modal')"
                    class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">Cancel</button>
                <button onclick="confirmDelete()"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Delete</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let profileData = {};

    // Utility function to escape HTML
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    let currentEnhancement = null;
    let deleteState = { type: null, id: null };

    // Initialization
    document.addEventListener('DOMContentLoaded', async () => {
        setupEventListeners();
        await loadProfile();
    });

    function setupEventListeners() {
        // Helper to safely attach listener
        const addListener = (id, event, handler) => {
            const el = document.getElementById(id);
            if (el) el.addEventListener(event, handler);
            else console.warn(`Element #${id} not found for event binding`);
        };

        // Header Actions
        addListener('analyze-btn', 'click', handleAnalyze);
        addListener('apply-enhancements-btn', 'click', handleApplyEnhancements);

        // Personal Info
        addListener('edit-personal-btn', 'click', () => {
            document.getElementById('personal-view').classList.add('hidden');
            document.getElementById('personal-form').classList.remove('hidden');
            if (profileData.profile) {
                document.getElementById('input-name').value = profileData.profile.full_name || '';
                document.getElementById('input-email').value = profileData.profile.email || '';
                document.getElementById('input-phone').value = profileData.profile.phone || '';
                document.getElementById('input-location').value = profileData.profile.location || '';
                document.getElementById('input-linkedin').value = profileData.profile.linkedin || '';
                document.getElementById('input-github').value = profileData.profile.github || '';
            }
        });
        addListener('cancel-personal-btn', 'click', () => {
            document.getElementById('personal-form').classList.add('hidden');
            document.getElementById('personal-view').classList.remove('hidden');
        });
        addListener('personal-form', 'submit', handlePersonalSubmit);

        // Summary
        addListener('edit-summary-btn', 'click', () => {
            document.getElementById('summary-view').classList.add('hidden');
            document.getElementById('summary-form').classList.remove('hidden');
            if (profileData.profile) {
                document.getElementById('input-summary').value = profileData.profile.summary || '';
            }
        });
        addListener('cancel-summary-btn', 'click', () => {
            document.getElementById('summary-form').classList.add('hidden');
            document.getElementById('summary-view').classList.remove('hidden');
        });
        addListener('summary-form', 'submit', handleSummarySubmit);

        // Modals Triggers
        addListener('add-experience-btn', 'click', () => {
            document.getElementById('exp-id').value = '';
            document.getElementById('experience-form').reset();
            document.getElementById('exp-modal-title').textContent = 'Add Experience';
            openModal('experience-modal');
        });
        addListener('experience-form', 'submit', handleExperienceSubmit);

        addListener('add-education-btn', 'click', () => {
            document.getElementById('edu-id').value = '';
            document.getElementById('education-form').reset();
            document.getElementById('edu-modal-title').textContent = 'Add Education';
            openModal('education-modal');
        });
        addListener('education-form', 'submit', handleEducationSubmit);

        addListener('add-skill-btn', 'click', () => {
            document.getElementById('skill-id').value = '';
            document.getElementById('skills-form').reset();
            document.getElementById('skill-modal-title').textContent = 'Add Skill Category';
            openModal('skills-modal');
        });
        addListener('skills-form', 'submit', handleSkillsSubmit);

        addListener('add-project-btn', 'click', () => {
            document.getElementById('project-id').value = '';
            document.getElementById('projects-form').reset();
            document.getElementById('project-modal-title').textContent = 'Add Project';
            openModal('projects-modal');
        });
        addListener('projects-form', 'submit', handleProjectSubmit);

        // Resume Upload
        const uploadInput = document.getElementById('resume-upload');
        if (uploadInput) {
            uploadInput.addEventListener('change', handleResumeUpload);
        }
    }

    // --- HANDLERS ---

    async function handleResumeUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);

        // Show global loading or toast
        showToast('Uploading and analyzing resume...', 'info');

        try {
            const response = await axios.post('/api/resume/upload', formData, {
                headers: { 'Content-Type': 'multipart/form-data' }
            });

            showToast('Resume imported successfully!', 'success');
            await loadProfile(); // Refresh UI with new data
        } catch (error) {
            console.error('Upload failed:', error);
            showToast(error.response?.data?.detail || 'Failed to upload resume', 'error');
        } finally {
            e.target.value = ''; // Reset input
        }
    }

    async function handleAnalyze() {
        const btn = document.getElementById('analyze-btn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Analyzing...';
        btn.disabled = true;

        try {
            const response = await axios.post('/api/resume/analyze');
            const result = response.data;
            currentEnhancement = result;

            document.getElementById('score-value').textContent = result.score;
            animateScore(result.score);

            document.getElementById('analysis-strengths').innerHTML = (result.strengths || []).map(s =>
                `<li class="flex items-start"><i class="fa-solid fa-check text-green-500 mt-1 mr-2 text-xs"></i><span>${s}</span></li>`
            ).join('');

            document.getElementById('analysis-weaknesses').innerHTML = (result.weaknesses || []).map(w =>
                `<li class="flex items-start"><i class="fa-solid fa-circle-exclamation text-red-500 mt-1 mr-2 text-xs"></i><span>${w}</span></li>`
            ).join('');

            document.getElementById('analysis-suggestions').innerHTML = (result.suggestions || []).map(s =>
                `<li>${s}</li>`
            ).join('');

            openModal('analysis-modal');
        } catch (error) {
            console.error('Analysis failed:', error);
            showToast('Failed to analyze resume', 'error');
        } finally {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }
    }

    async function handleApplyEnhancements() {
        if (!currentEnhancement || !currentEnhancement.enhanced_profile) return;

        const btn = document.getElementById('apply-enhancements-btn');
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Applying...';
        btn.disabled = true;

        try {
            await axios.post('/api/resume/apply_enhancements', {
                enhanced_profile: currentEnhancement.enhanced_profile
            });
            showToast('Resume enhanced successfully!', 'success');
            closeModal('analysis-modal');
            await loadProfile();
        } catch (error) {
            console.error('Failed to apply:', error);
            showToast('Failed to apply enhancements', 'error');
        } finally {
            btn.innerHTML = originalContent;
            btn.disabled = false;
        }
    }

    async function handlePersonalSubmit(e) {
        e.preventDefault();
        const data = {
            full_name: document.getElementById('input-name').value,
            email: document.getElementById('input-email').value,
            phone: document.getElementById('input-phone').value,
            location: document.getElementById('input-location').value,
            linkedin: document.getElementById('input-linkedin').value,
            github: document.getElementById('input-github').value
        };
        try {
            await axios.put('/api/profile', data);
            showToast('Personal information updated!', 'success');
            await loadProfile();
            document.getElementById('personal-form').classList.add('hidden');
            document.getElementById('personal-view').classList.remove('hidden');
        } catch (error) {
            showToast('Failed to update personal information', 'error');
        }
    }

    async function handleSummarySubmit(e) {
        e.preventDefault();
        try {
            await axios.put('/api/profile', {
                summary: document.getElementById('input-summary').value
            });
            showToast('Summary updated!', 'success');
            await loadProfile();
            document.getElementById('summary-form').classList.add('hidden');
            document.getElementById('summary-view').classList.remove('hidden');
        } catch (error) {
            showToast('Failed to update summary', 'error');
        }
    }

    async function handleExperienceSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('exp-id').value;
        const data = {
            title: document.getElementById('exp-title').value,
            company: document.getElementById('exp-company').value,
            start_date: document.getElementById('exp-start').value,
            end_date: document.getElementById('exp-end').value,
            description: document.getElementById('exp-desc').value,
            achievements: document.getElementById('exp-achievements').value.split('\n').filter(a => a.trim())
        };
        try {
            if (id) {
                await axios.put(`/api/profile/experience/${id}`, data);
                showToast('Experience updated!', 'success');
            } else {
                await axios.post('/api/profile/experience', data);
                showToast('Experience added!', 'success');
            }
            closeModal('experience-modal');
            await loadProfile();
        } catch (error) {
            showToast('Failed to save experience', 'error');
        }
    }

    async function handleEducationSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('edu-id').value;
        const data = {
            degree: document.getElementById('edu-degree').value,
            institution: document.getElementById('edu-school').value,
            graduation_date: document.getElementById('edu-date').value,
            gpa: document.getElementById('edu-gpa').value
        };
        try {
            if (id) {
                await axios.put(`/api/profile/education/${id}`, data);
                showToast('Education updated!', 'success');
            } else {
                await axios.post('/api/profile/education', data);
                showToast('Education added!', 'success');
            }
            closeModal('education-modal');
            await loadProfile();
        } catch (error) {
            showToast('Failed to save education', 'error');
        }
    }

    async function handleSkillsSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('skill-id').value;
        const data = {
            category: document.getElementById('skill-category').value,
            skills: document.getElementById('skill-list-input').value.split(',').map(s => s.trim()).filter(Boolean)
        };
        try {
            if (id) {
                await axios.put(`/api/profile/skills/${id}`, data);
                showToast('Skills updated!', 'success');
            } else {
                await axios.post('/api/profile/skills', data);
                showToast('Skills added!', 'success');
            }
            closeModal('skills-modal');
            await loadProfile();
        } catch (error) {
            showToast('Failed to save skills', 'error');
        }
    }

    async function handleProjectSubmit(e) {
        e.preventDefault();
        const id = document.getElementById('project-id').value;
        const data = {
            name: document.getElementById('project-name').value,
            date: document.getElementById('project-date').value,
            description: document.getElementById('project-desc').value,
            technologies: document.getElementById('project-tech').value.split(',').map(t => t.trim()).filter(Boolean)
        };
        try {
            if (id) {
                await axios.put(`/api/profile/projects/${id}`, data);
                showToast('Project updated!', 'success');
            } else {
                await axios.post('/api/profile/projects', data);
                showToast('Project added!', 'success');
            }
            closeModal('projects-modal');
            await loadProfile();
        } catch (error) {
            showToast('Failed to save project', 'error');
        }
    }

    // --- CORE API & RENDER FUNCTIONS ---

    async function loadProfile() {
        try {
            const response = await axios.get('/api/profile');
            profileData = response.data;

            // Optional Chaining for data safety
            const p = profileData.profile || {};

            const setText = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.textContent = val || '-';
            };

            setText('view-name', p.full_name);
            setText('view-email', p.email);
            setText('view-phone', p.phone);
            setText('view-location', p.location);
            setText('view-linkedin', p.linkedin);
            setText('view-github', p.github);

            const summaryEl = document.getElementById('view-summary');
            if (summaryEl) summaryEl.textContent = p.summary || 'No summary added yet.';

            // Ensure languages and hobbies are arrays
            profileData.languages = profileData.profile?.languages || [];
            profileData.hobbies = profileData.profile?.hobbies || [];

            renderExperiences();
            renderEducation();
            renderSkills();
            renderProjects();
            renderLanguages();
            renderHobbies();
            await loadResumeHistory();

        } catch (error) {
            console.error('Error loading profile:', error);
            showToast('Failed to load profile', 'error');
        }
    }

    function renderExperiences() {
        const container = document.getElementById('experience-list');
        if (!container) return;
        if ((profileData.experiences || []).length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No experience added yet.</p>';
            return;
        }

        container.innerHTML = profileData.experiences.map(exp => `
        <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="font-semibold text-slate-900 dark:text-slate-100">${exp.title}</h3>
                    <p class="text-primary">${exp.company}</p>
                    <p class="text-sm text-slate-600 dark:text-slate-400">${exp.start_date} - ${exp.end_date}</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="editExperience(${exp.id})" class="text-blue-600 hover:text-blue-800"><i class="fa-solid fa-edit"></i></button>
                    <button onclick="deleteExperience(${exp.id})" class="text-red-600 hover:text-red-800"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
            ${exp.description ? `<p class="mt-2 text-slate-700 dark:text-slate-300">${exp.description}</p>` : ''}
            ${exp.achievements && exp.achievements.length > 0 ? `<ul class="mt-2 list-disc list-inside text-slate-700 dark:text-slate-300">${exp.achievements.map(a => `<li>${a}</li>`).join('')}</ul>` : ''}
        </div>
    `).join('');
    }

    function renderEducation() {
        const container = document.getElementById('education-list');
        if (!container) return;
        if ((profileData.education || []).length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No education added yet.</p>';
            return;
        }
        container.innerHTML = profileData.education.map(edu => `
        <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="font-semibold text-slate-900 dark:text-slate-100">${edu.degree}</h3>
                    <p class="text-primary">${edu.institution}</p>
                    <p class="text-sm text-slate-600 dark:text-slate-400">${edu.graduation_date}</p>
                    ${edu.gpa ? `<p class="text-sm text-slate-600 dark:text-slate-400">GPA: ${edu.gpa}</p>` : ''}
                </div>
                <div class="flex gap-2">
                    <button onclick="editEducation(${edu.id})" class="text-blue-600 hover:text-blue-800"><i class="fa-solid fa-edit"></i></button>
                    <button onclick="deleteEducation(${edu.id})" class="text-red-600 hover:text-red-800"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
        </div>
    `).join('');
    }

    function renderSkills() {
        const container = document.getElementById('skills-list');
        if (!container) return;
        if ((profileData.skills || []).length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No skills added yet.</p>';
            return;
        }
        container.innerHTML = profileData.skills.map(skill => `
        <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
            <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-slate-900 dark:text-slate-100">${skill.category}</h3>
                <div class="flex gap-2">
                    <button onclick="editSkill(${skill.id})" class="text-blue-600 hover:text-blue-800"><i class="fa-solid fa-edit"></i></button>
                    <button onclick="deleteSkill(${skill.id})" class="text-red-600 hover:text-red-800"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
            <div class="flex flex-wrap gap-2">
                ${(skill.skills || []).map(s => `<span class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-sm">${s}</span>`).join('')}
            </div>
        </div>
    `).join('');
    }

    function renderProjects() {
        const container = document.getElementById('projects-list');
        if (!container) return;
        if ((profileData.projects || []).length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No projects added yet.</p>';
            return;
        }
        container.innerHTML = profileData.projects.map(proj => `
        <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
            <div class="flex justify-between items-start">
                <div>
                    <h3 class="font-semibold text-slate-900 dark:text-slate-100">${proj.name}</h3>
                    ${proj.date ? `<p class="text-sm text-slate-600 dark:text-slate-400">${proj.date}</p>` : ''}
                    <p class="mt-2 text-slate-700 dark:text-slate-300">${proj.description}</p>
                    ${proj.technologies && proj.technologies.length > 0 ? `<div class="flex flex-wrap gap-2 mt-2">${proj.technologies.map(t => `<span class="px-2 py-1 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded text-xs">${t}</span>`).join('')}</div>` : ''}
                </div>
                <div class="flex gap-2">
                    <button onclick="editProject(${proj.id})" class="text-blue-600 hover:text-blue-800"><i class="fa-solid fa-edit"></i></button>
                    <button onclick="deleteProject(${proj.id})" class="text-red-600 hover:text-red-800"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
        </div>
    `).join('');
    }

    async function loadResumeHistory() {
        try {
            const response = await axios.get('/api/profile/resume-history');
            const container = document.getElementById('resume-history-grid');
            if (!container) return;

            if ((response.data.resumes || []).length === 0) {
                container.innerHTML = '<p class="text-slate-500 dark:text-slate-400 col-span-full">No resumes generated yet.</p>';
                return;
            }

            container.innerHTML = response.data.resumes.map(resume => `
            <div class="border border-slate-200 dark:border-slate-700 rounded-lg p-4">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="font-semibold text-slate-900 dark:text-slate-100">${resume.title}</h3>
                    <button onclick="toggleFavorite(${resume.id}, ${resume.is_favorite})" class="text-yellow-500 hover:text-yellow-600">
                        <i class="fa-${resume.is_favorite ? 'solid' : 'regular'} fa-star"></i>
                    </button>
                </div>
                <p class="text-sm text-slate-600 dark:text-slate-400">Template: ${resume.template_used}</p>
                <p class="text-sm text-slate-600 dark:text-slate-400">Created: ${new Date(resume.created_at).toLocaleDateString()}</p>
                <div class="flex gap-2 mt-4">
                    <a href="${resume.file_path}" download class="flex-1 text-center px-3 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">
                        <i class="fa-solid fa-download mr-1"></i>Download
                    </a>
                    <button onclick="deleteResume(${resume.id})" class="px-3 py-2 border border-red-600 text-red-600 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 text-sm">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
        } catch (error) {
            console.error('Error loading resume history:', error);
        }
    }

    function renderLanguages() {
        const container = document.getElementById('languages-list');
        const languages = profileData.languages || [];

        if (languages.length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No languages added yet.</p>';
            return;
        }

        container.innerHTML = languages.map(lang => `
            <span class="inline-flex items-center gap-2 px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full text-sm">
                ${escapeHtml(lang)}
                <button onclick="removeLanguage('${escapeHtml(lang)}')" class="hover:text-red-600">
                    <i class="fa-solid fa-times"></i>
                </button>
            </span>
        `).join('');
    }

    function renderHobbies() {
        const container = document.getElementById('hobbies-list');
        const hobbies = profileData.hobbies || [];

        if (hobbies.length === 0) {
            container.innerHTML = '<p class="text-slate-500 dark:text-slate-400">No hobbies added yet.</p>';
            return;
        }

        container.innerHTML = hobbies.map(hobby => `
            <span class="inline-flex items-center gap-2 px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 rounded-full text-sm">
                ${escapeHtml(hobby)}
                <button onclick="removeHobby('${escapeHtml(hobby)}')" class="hover:text-red-600">
                    <i class="fa-solid fa-times"></i>
                </button>
            </span>
        `).join('');
    }

    // Add Language
    window.addLanguage = async function () {
        const input = document.getElementById('language-input');
        const language = input.value.trim();

        if (!language) return;

        try {
            const languages = profileData.languages || [];
            if (languages.includes(language)) {
                showToast('Language already added', 'error');
                return;
            }

            languages.push(language);
            await axios.post('/api/profile/', { languages: JSON.stringify(languages) });

            profileData.languages = languages;
            renderLanguages();
            input.value = '';
            showToast('Language added!', 'success');
        } catch (error) {
            console.error('Error adding language:', error);
            showToast('Failed to add language', 'error');
        }
    }

    // Remove Language
    window.removeLanguage = async function (language) {
        try {
            const languages = (profileData.languages || []).filter(l => l !== language);
            await axios.post('/api/profile/', { languages: JSON.stringify(languages) });

            profileData.languages = languages;
            renderLanguages();
            showToast('Language removed', 'success');
        } catch (error) {
            showToast('Failed to remove language', 'error');
        }
    }

    // Add Hobby
    window.addHobby = async function () {
        const input = document.getElementById('hobby-input');
        const hobby = input.value.trim();

        if (!hobby) return;

        try {
            const hobbies = profileData.hobbies || [];
            if (hobbies.includes(hobby)) {
                showToast('Hobby already added', 'error');
                return;
            }

            hobbies.push(hobby);
            await axios.post('/api/profile/', { hobbies: JSON.stringify(hobbies) });

            profileData.hobbies = hobbies;
            renderHobbies();
            input.value = '';
            showToast('Hobby added!', 'success');
        } catch (error) {
            console.error('Error adding hobby:', error);
            showToast('Failed to add hobby', 'error');
        }
    }

    // Remove Hobby
    window.removeHobby = async function (hobby) {
        try {
            const hobbies = (profileData.hobbies || []).filter(h => h !== hobby);
            await axios.post('/api/profile/', { hobbies: JSON.stringify(hobbies) });

            profileData.hobbies = hobbies;
            renderHobbies();
            showToast('Hobby removed', 'success');
        } catch (error) {
            showToast('Failed to remove hobby', 'error');
        }
    }

    // Modal Helpers
    function openModal(id) {
        document.getElementById(id).classList.remove('hidden');
    }
    window.closeModal = function (id) {
        document.getElementById(id).classList.add('hidden');
    }

    // Delete Modal
    window.openDeleteModal = function (type, id) {
        deleteState = { type, id };
        openModal('delete-modal');
    }

    window.confirmDelete = async function () {
        if (!deleteState.type || !deleteState.id) return;
        const { type, id } = deleteState;
        closeModal('delete-modal');
        try {
            let endpoint = '';
            let msg = '';
            if (type === 'resume') {
                endpoint = `/api/profile/resume-history/${id}`;
                msg = 'Resume deleted';
                await axios.delete(endpoint);
                await loadResumeHistory();
            } else {
                endpoint = `/api/profile/${type}/${id}`;
                msg = 'Item deleted';
                await axios.delete(endpoint);
                await loadProfile();
            }
            showToast(msg, 'success');
        } catch (error) {
            console.error(error);
            showToast('Failed to delete item', 'error');
        }
    }

    // Window assignments for Onclick
    window.editExperience = function (id) {
        const exp = profileData.experiences.find(e => e.id === id);
        if (!exp) return;
        document.getElementById('exp-id').value = exp.id;
        document.getElementById('exp-title').value = exp.title;
        document.getElementById('exp-company').value = exp.company;
        document.getElementById('exp-start').value = exp.start_date;
        document.getElementById('exp-end').value = exp.end_date;
        document.getElementById('exp-desc').value = exp.description || '';
        document.getElementById('exp-achievements').value = (exp.achievements || []).join('\n');
        document.getElementById('exp-modal-title').textContent = 'Edit Experience';
        openModal('experience-modal');
    };
    window.deleteExperience = (id) => openDeleteModal('experience', id);

    window.editEducation = function (id) {
        const edu = profileData.education.find(e => e.id === id);
        if (!edu) return;
        document.getElementById('edu-id').value = edu.id;
        document.getElementById('edu-degree').value = edu.degree;
        document.getElementById('edu-school').value = edu.institution;
        document.getElementById('edu-date').value = edu.graduation_date;
        document.getElementById('edu-gpa').value = edu.gpa || '';
        document.getElementById('edu-modal-title').textContent = 'Edit Education';
        openModal('education-modal');
    };
    window.deleteEducation = (id) => openDeleteModal('education', id);

    window.editSkill = function (id) {
        const skill = profileData.skills.find(s => s.id === id);
        if (!skill) return;
        document.getElementById('skill-id').value = skill.id;
        document.getElementById('skill-category').value = skill.category;
        document.getElementById('skill-list-input').value = skill.skills.join(', ');
        document.getElementById('skill-modal-title').textContent = 'Edit Skill Category';
        openModal('skills-modal');
    };
    window.deleteSkill = (id) => openDeleteModal('skills', id);

    window.editProject = function (id) {
        const proj = profileData.projects.find(p => p.id === id);
        if (!proj) return;
        document.getElementById('project-id').value = proj.id;
        document.getElementById('project-name').value = proj.name;
        document.getElementById('project-date').value = proj.date;
        document.getElementById('project-desc').value = proj.description || '';
        document.getElementById('project-tech').value = (proj.technologies || []).join(', ');
        document.getElementById('project-modal-title').textContent = 'Edit Project';
        openModal('projects-modal');
    };
    window.deleteProject = (id) => openDeleteModal('projects', id);
    window.deleteResume = (id) => openDeleteModal('resume', id);

    window.toggleFavorite = async function (id, currentStatus) {
        try {
            await axios.put(`/api/profile/resume-history/${id}/favorite`);
            await loadResumeHistory();
        } catch (error) {
            showToast('Failed to update favorite', 'error');
        }
    }

    function animateScore(score) {
        const circle = document.getElementById('score-circle');
        if (!circle) return;
        const radius = circle.r.baseVal.value;
        const circumference = radius * 2 * Math.PI;
        circle.style.strokeDasharray = `${circumference} ${circumference}`;
        circle.style.strokeDashoffset = circumference;
        const offset = circumference - (score / 100) * circumference;
        if (score >= 80) circle.classList.add('text-green-500');
        else if (score >= 50) circle.classList.add('text-yellow-500');
        else circle.classList.add('text-red-500');
        setTimeout(() => {
            circle.style.strokeDashoffset = offset;
        }, 100);
    }

    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`;
        toast.innerHTML = `<div class="flex items-center gap-3"><i class="fa-solid ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} text-xl"></i><span class="font-medium">${message}</span></div>`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
        setupEventListeners(); // Register all event handlers
        await loadProfile();
        await loadResumeHistory();
    });
</script>
{% endblock %}