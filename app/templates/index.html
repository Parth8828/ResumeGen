{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
    <!-- Header Section -->
    <div class="text-center space-y-4">
        <h1 class="text-4xl font-bold text-slate-900 dark:text-slate-100">Build Your Perfect Resume with AI</h1>
        <p class="text-xl text-slate-600 dark:text-slate-300 max-w-2xl mx-auto">Create ATS-friendly resumes, get instant
            feedback, and find
            your dream job - all in one place.</p>
    </div>

    <!-- Features Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Feature 1: Chat Builder -->
        <a href="/chat" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-blue-100 text-primary rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-primary group-hover:text-white transition-colors">
                <i class="fa-solid fa-comments"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">AI Chat Builder</h3>
            <p class="text-slate-600 dark:text-slate-300">Chat with our AI to build your resume. It drafts summaries and
                bullet points for
                you.</p>
        </a>

        <!-- Feature 2: Resume Scorer -->
        <a href="/scorer" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-green-100 text-green-600 rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-green-600 group-hover:text-white transition-colors">
                <i class="fa-solid fa-chart-line"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">Resume Scorer</h3>
            <p class="text-slate-600 dark:text-slate-300">Upload your current resume and get a score out of 100 with
                actionable
                improvements.</p>
        </a>

        <!-- Feature 3: Cover Letter Generator -->
        <a href="/cover-letter" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-orange-600 group-hover:text-white transition-colors">
                <i class="fa-solid fa-envelope"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">Cover Letter AI</h3>
            <p class="text-slate-600 dark:text-slate-300">Generate personalized cover letters in seconds with AI
                assistance.</p>
        </a>

        <!-- Feature 4: Resume Templates -->
        <a href="/templates" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-indigo-100 text-indigo-600 rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                <i class="fa-solid fa-palette"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">Resume Templates</h3>
            <p class="text-slate-600 dark:text-slate-300">Choose from professional, ATS-friendly resume templates.</p>
        </a>

        <!-- Feature 5: My Profile -->
        <a href="/profile" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-teal-100 text-teal-600 rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-teal-600 group-hover:text-white transition-colors">
                <i class="fa-solid fa-user"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">My Profile</h3>
            <p class="text-slate-600 dark:text-slate-300">Manage your information and view resume history.</p>
        </a>

        <!-- Feature 6: Job Search -->
        <a href="/jobs" class="glass-card p-6 block hover:no-underline group">
            <div
                class="h-12 w-12 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mb-4 text-xl group-hover:bg-purple-600 group-hover:text-white transition-colors">
                <i class="fa-solid fa-briefcase"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2">Job Recommendations</h3>
            <p class="text-slate-600 dark:text-slate-300">Get real-time job suggestions that match your skills and
                experience level.</p>
        </a>
    </div>

    <!-- Recent Activity Section -->
    <div class="mt-12">
        <h2 class="text-2xl font-bold text-slate-900 dark:text-slate-100 mb-6">Recent Activity</h2>
        <div id="recent-activity-container">
            <!-- Loading state -->
            <div id="activity-loading" class="glass-card p-8 text-center text-slate-500 dark:text-slate-400">
                <i class="fa-solid fa-spinner fa-spin text-3xl mb-4"></i>
                <p>Loading recent activity...</p>
            </div>

            <!-- Empty state -->
            <div id="activity-empty" class="glass-card p-8 text-center text-slate-500 dark:text-slate-400 hidden">
                <div class="mb-4">
                    <i class="fa-regular fa-folder-open text-4xl text-slate-300"></i>
                </div>
                <p>No resumes created yet. Start a chat to build one!</p>
                <a href="/chat" class="inline-block mt-4 text-primary font-medium hover:text-blue-700">Start Building
                    &rarr;</a>
            </div>

            <!-- Activity list -->
            <div id="activity-list" class="space-y-4 hidden"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadRecentActivity() {
        const loading = document.getElementById('activity-loading');
        const empty = document.getElementById('activity-empty');
        const list = document.getElementById('activity-list');

        try {
            const response = await axios.get('/api/profile/resume-history');
            const data = response.data;
            const resumes = data.resumes || data; // Handle both formats

            loading.classList.add('hidden');

            if (!resumes || resumes.length === 0) {
                empty.classList.remove('hidden');
                return;
            }

            // Show only the 5 most recent
            const recentResumes = resumes.slice(0, 5);

            list.innerHTML = recentResumes.map(resume => {
                const date = new Date(resume.created_at);
                const formattedDate = date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const title = resume.title || resume.filename || 'Resume';

                return `
                    <div class="glass-card p-4 hover:shadow-lg transition-shadow">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4 flex-1">
                                <div class="h-10 w-10 bg-primary/10 text-primary rounded-lg flex items-center justify-center">
                                    <i class="fa-solid fa-file-pdf"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-slate-900 dark:text-slate-100">
                                        ${title}
                                    </h3>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">
                                        <i class="fa-regular fa-clock mr-1"></i>${formattedDate}
                                        ${resume.template_used ? `<span class="ml-3"><i class="fa-solid fa-palette mr-1"></i>${resume.template_used}</span>` : ''}
                                    </p>
                                </div>
                            </div>
                            <a href="/api/profile/resume-history/${resume.id}/download" 
                               class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                                <i class="fa-solid fa-download mr-1"></i>Download
                            </a>
                        </div>
                    </div>
                `;
            }).join('');

            list.classList.remove('hidden');
        } catch (error) {
            console.error('Failed to load recent activity:', error);
            loading.classList.add('hidden');
            empty.classList.remove('hidden');
        }
    }

    // Load on page ready
    document.addEventListener('DOMContentLoaded', loadRecentActivity);
</script>
{% endblock %}